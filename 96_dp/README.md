# 设计模式

在软件开发中，经常会遇到各种各样的编码场景，这些场景往往重复发生，因此具有典型性。针对这些典型场景，可以自己编码解决，也可以采取更为省时省力的方式：直接采用设计模式。设计模式简单来说，就是将软件开发中需要重复性解决的编码场景，按最佳实践的方式抽象成一个模型，模型描述的解决方法就是设计模式。使用设计模式，可以使代码更易于理解，保证代码的重用性和可靠性。

在软件领域，GoF（四人帮，全拼 Gang of Four）首次系统化提出了 3 大类、共 25 种可复用的经典设计方案，来解决常见的软件设计问题，为可复用软件设计奠定了一定的理论基础。从总体上说，这些设计模式可以分为创建型模式、结构型模式、行为型模式 3 大类，用来完成不同的场景。

本章会介绍几个在Go项目开发中比较常用的设计模式，帮助用更加简单快捷的方法应对不同的编码场景。其中，简单工厂模式、抽象工厂模式和工厂方法模式都属于工厂模式。

## 创建型

创建型模式（Creational Patterns）提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。

### 单例模式

单例模式（Singleton Pattern）是最简单的一个模式，在 Go 中指的是全局只有一个实例，并且它负责创建自己的对象。单例模式不仅有利于减少内存开支，还有减少系统性能开销、防止多个实例产生冲突等优点。因为单例模式保证了实例的全局唯一性，而且只被初始化一次，所以比较适合全局共享一个实例，且只需要被初始化一次的场景，例如数据库实例、全局配置、全局任务池等。

单例模式又分为饿汉方式和懒汉方式：

- 饿汉方式：指全局的单例实例在包被加载时创建
- 懒汉方式：指全局的单例实例在第一次被使用时创建

#### Lab

- [单例模式](10_singleton/main.go)

```bash
cd 10_singleton
go run main.go
```

### 工厂模式

工厂模式（Factory Pattern）是面向对象编程中的常用模式。在 Go 项目开发中，可以通过使用多种不同的工厂模式，来使代码更简洁明了。Go 中的结构体+方法，可以理解为面向对象编程中的类。有了 “类”，就可以创建“类”相关的实例。可以通过简单工厂模式、抽象工厂模式、工厂方法模式这 3 种方式，来创建实例。

#### 简单工厂模式

简单工厂模式是最常用、最简单的。它就是一个接受一些参数，然后返回实例的函数。

参考代码案例，和 `p：=＆Person {}` 这种创建实例的方式相比，简单工厂模式可以确保创建的实例具有需要的参数，进而保证实例的方法可以按预期执行。例如，通过 NewPerson() 创建 Person 实例时，可以确保实例的 name 和 age 属性被设置。

##### Lab

- [简单工厂模式](20_factory/10_simple.go)

```bash
cd 20_factory
go run 10_simple.go
```

#### 抽象工厂模式

抽象工厂模式与简单工厂模式的唯一区别，就是它返回的是接口而不是结构体。通过返回接口，可以在不公开内部实现的情况下，让调用者使用提供的各种功能。

##### Lab

- [抽象工厂模式](20_factory/20_abstract.go)

```bash
go run 20_factory/20_abstract.go
```

#### 工厂方法模式

在简单工厂模式中，依赖于唯一的工厂对象，如果需要实例化一个产品，就要向工厂中传入一个参数，获取对应的对象。但如果要增加一种产品，就要在工厂中修改创建产品的函数。这会导致耦合性过高，这时就可以使用工厂方法模式。

在工厂方法模式中，将返回工厂函数，可以通过实现工厂函数来创建多种工厂，从而将过程解耦。

##### Lab
- [工厂方法模式](20_factory/30_method.go)

```bash
go run 20_factory/30_method.go
```

### 创造者模式



### 原型模式



## 结构型

结构型模式（Structural Patterns）关注类和对象的组合。



### 访问者模式



### 策略模式

### 模板模式

模版模式 (Template Pattern)  定义一个操作中算法的骨架，而将一些步骤延迟到子类中。这种方法让子类在不改变一个算法结构的情况下，就能重新定义该算法的某些特定步骤。

简单来说，模板模式就是将一个类中能够公共使用的方法放置在抽象类中实现，将不能公共使用的方法作为抽象方法，强制子类去实现，这样就做到了将一个类作为一个模板，让开发者去填充需要填充的地方。

- [模板模式](35_template/main.go)

```bash
go run 35_template/main.go
```

### 状态模式



### 观察者模式



### 备忘录模式



### 中介者模式



### 迭代器模式



### 解释器模式



### 命令模式



### 责任链模式



## 行为型

行为型模式（Behavioral Patterns）是关注对象之间的通信。



### 适配器模式



### 桥接模式



### 组合模式



### 装饰模式



### 外观模式



### 享元模式



### 代理模式

代理模式 (Proxy Pattern)，可以为另一个对象提供一个替身，以控制对这个对象的访问。

Proxy 将对象嵌入其结构体，从而可通过 Proxy 的方法操作对象。

- [代理模式](60_proxy/main.go)

```bash
go run 60_proxy/main.go
```

### 选项模式

选项模式（Options Pattern）是 Go 项目经常使用到的模式，如grpc/grpc-go 的 NewServer 函数，uber-go/zap 的 New 函数都用到了选项模式。使用选项模式，可以创建一个带有默认值的 struct 变量，并选择性地修改其中一些参数的值。

在 Python 中创建一个对象时，可以给参数设置默认值，这样在不传入任何参数时，可以返回默认值，并在需要时修改对象的属性。这种特性可以大大简化开发者创建一个对象的成本，尤其是在对象拥有众多属性时。而在 Go 中，因为不支持给参数设置默认值。

